"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function getLoginCookie(setCookieHeader, host, cookieKey) {
    if (cookieKey === void 0) { cookieKey = 'SHOP_TOKEN'; }
    if (!setCookieHeader)
        return null;
    var cookies = setCookieHeader.split(/, (?=[^;]+=[^;]+;)/);
    var cookie = cookies.find(function (cookie) { return cookie.startsWith(cookieKey + "="); }) || null;
    if (!cookie)
        return null;
    // Set the cookie at TLD to make it accessible on subdomains (embedded checkout)
    cookie =
        cookie +
            ("; Domain=" + ((host === null || host === void 0 ? void 0 : host.includes(':')) ? host === null || host === void 0 ? void 0 : host.slice(0, host.indexOf(':')) : host));
    // In development, don't set a secure cookie or the browser will ignore it
    if (process.env.NODE_ENV !== 'production') {
        cookie = cookie.replace(/; Secure/gi, '');
        // SameSite=none can't be set unless the cookie is Secure
        // bc seems to sometimes send back SameSite=None rather than none so make
        // this case insensitive
        cookie = cookie.replace(/; SameSite=none/gi, '; SameSite=lax');
    }
    return cookie;
}
exports.default = getLoginCookie;
